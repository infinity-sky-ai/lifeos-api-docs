openapi: 3.1.0
info:
  title: LifeOS API
  version: 1.0.0
  description: |
    The LifeOS API provides programmatic access to your habit tracking data.

    ## Authentication
    All requests require a Bearer token in the Authorization header.
    Generate API keys from Settings > API in the LifeOS app.

    ```
    Authorization: Bearer sk_live_...
    ```

    ## Permissions
    API keys have granular permissions per resource (habits, habit_entries).
    Each resource supports: read, create, update, delete.

servers:
  - url: https://lifeos-ashy.vercel.app
    description: Production
  - url: http://localhost:3000
    description: Local development

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: API key generated from LifeOS Settings

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
      required: [error]

    Habit:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        icon:
          type: string
          nullable: true
        color:
          type: string
          nullable: true
        frequency_type:
          type: string
          enum: [daily, weekly, custom]
        frequency_days:
          type: array
          items:
            type: integer
          nullable: true
        frequency_period:
          type: string
          nullable: true
        frequency_times_per_period:
          type: integer
          nullable: true
        is_active:
          type: boolean
        archived_at:
          type: string
          format: date-time
          nullable: true
        sort_order:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    HabitEntry:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        habit_id:
          type: string
          format: uuid
        entry_date:
          type: string
          format: date
        completed:
          type: boolean
        value:
          type: number
          nullable: true
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

paths:
  /api/v1/habits:
    get:
      tags: [Habits]
      summary: List habits
      description: Returns all non-archived habits. Use include_archived=true to include archived ones.
      parameters:
        - name: include_archived
          in: query
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: List of habits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Habit"
              example:
                - id: "550e8400-e29b-41d4-a716-446655440000"
                  name: "Morning Meditation"
                  frequency_type: "daily"
                  icon: "brain"
                  color: "#8B5CF6"
                  is_active: true
                  created_at: "2025-01-15T10:00:00Z"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    post:
      tags: [Habits]
      summary: Create a habit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, frequency_type]
              properties:
                name:
                  type: string
                frequency_type:
                  type: string
                  enum: [daily, weekly, custom]
                description:
                  type: string
                category:
                  type: string
                icon:
                  type: string
                color:
                  type: string
                frequency_days:
                  type: array
                  items:
                    type: integer
            example:
              name: "Read for 30 minutes"
              frequency_type: "daily"
              icon: "book-open"
              color: "#3B82F6"
      responses:
        "201":
          description: Created habit
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Habit"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/v1/habits/{id}:
    get:
      tags: [Habits]
      summary: Get a habit
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Habit details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Habit"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    patch:
      tags: [Habits]
      summary: Update a habit
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                category:
                  type: string
                icon:
                  type: string
                color:
                  type: string
                frequency_type:
                  type: string
                is_active:
                  type: boolean
            example:
              name: "Read for 45 minutes"
              color: "#10B981"
      responses:
        "200":
          description: Updated habit
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Habit"
    delete:
      tags: [Habits]
      summary: Archive or delete a habit
      description: Archives the habit by default. Use hard=true to permanently delete.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: hard
          in: query
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Archived or deleted

  /api/v1/habit-entries:
    get:
      tags: [Habit Entries]
      summary: List habit entries
      parameters:
        - name: habit_id
          in: query
          schema:
            type: string
            format: uuid
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            maximum: 1000
      responses:
        "200":
          description: List of entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/HabitEntry"
              example:
                - id: "660e8400-e29b-41d4-a716-446655440001"
                  habit_id: "550e8400-e29b-41d4-a716-446655440000"
                  entry_date: "2025-02-14"
                  completed: true
                  value: null
                  notes: null
    post:
      tags: [Habit Entries]
      summary: Create or toggle an entry
      description: Creates a new entry or toggles an existing one if an entry already exists for the given habit_id + entry_date.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [habit_id, entry_date]
              properties:
                habit_id:
                  type: string
                  format: uuid
                entry_date:
                  type: string
                  format: date
                completed:
                  type: boolean
                  default: true
                value:
                  type: number
                notes:
                  type: string
            example:
              habit_id: "550e8400-e29b-41d4-a716-446655440000"
              entry_date: "2025-02-14"
              completed: true
      responses:
        "201":
          description: Created entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HabitEntry"
        "200":
          description: Toggled existing entry

  /api/v1/habit-entries/{id}:
    get:
      tags: [Habit Entries]
      summary: Get a habit entry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Entry details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HabitEntry"
    patch:
      tags: [Habit Entries]
      summary: Update an entry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                completed:
                  type: boolean
                value:
                  type: number
                notes:
                  type: string
      responses:
        "200":
          description: Updated entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HabitEntry"
    delete:
      tags: [Habit Entries]
      summary: Delete an entry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean
